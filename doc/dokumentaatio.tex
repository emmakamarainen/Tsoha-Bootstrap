\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[finnish]{babel}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{url}

\usepackage{color}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true, % make the links colored
    linkcolor=black, % color TOC links in blue
    urlcolor=red, % color URLs in red
    linktoc=all % 'all' will create links for everything in the TOC
}


\begin{document}

\section*{Tietokantasovellus, harjoitustyö}

\tableofcontents

\section{Johdanto}

Harjoitustyön aiheena drinkkiarkisto. Tarkoituksena on luoda drinkkireseptejä sisältävä www-sivusto. Sivuustoon kirjaudutaan sisään. Kirjautunut käyttäjä voi olla joko ylläpitäjä tai sitten tavallinen käyttäjä. Ylläpitäjällä on mahdollisuus lisätä ylläpito-oikeudet tavalliselle käyttäjälle.   

Kirjautumisen jälkeen sivustolla voi selailla juoma-reseptejä, tutkia reseptien tietosivuja ja halutessaan lisätä juoman. Juomaan lisätään ainesosia yksi kerrallaan juoman tietosivulta. Jos ainesosa on jo olemassa, sitä ei lisätä tietokantaan. Myös kaikki tietokannassa olevat juomien ainesosat ovat selailtavissa omalla sivullaan. 

Mikäli kirjautuneella käyttäjällä on ylläpito-oikeudet, on hänen mahdollista nähdä myös käyttäjistä koostuva selailusivu. Tämän sivun  kautta ylläpitäjällä on mahdollisuus antaa muille käyttäjille ylläpito-oikeuksia. Jokainen käyttäjä pystyy muokkaamaan omia käyttäjätietojaan ja halutessaan poistaa itsensä sivustolta. 

Tietokantana on PostgreSQL. Harjoitustyö toteutetaan laitoksen user--palvelimella PHP-kielellä. 

\newpage
\section{Käyttäjistä}

\subsection{Käyttötapauskaavio}
\begin{figure}[h]
	\centering
	\includegraphics[scale=0.4]{kayttotapaukset.pdf}
	\caption{Käyttötapauskaavio}
\end{figure}
	
\subsection{Käyttäjäryhmät}

\begin{flushleft}Ylläpitäjä\end{flushleft}

Ylläpitäjän pitää olla rekisteröitynyt sivuston käyttäjä, jolle on annettu ylläpito-oikeudet. Sivusto vaatii sisäänkirjautumisen.

\begin{flushleft}Tavallinen käyttäjä\end{flushleft}

Tavallinen käyttäjä voi olla kuka tahansa sivulle kirjautunut henkilö. 

\newpage
\subsection{Käyttötapaukset}

\begin{flushleft}\textbf{Ylläpitäjä\(\colon\)} \end{flushleft}
\begin{itemize}
	\item Reseptien haku\(\colon\) käyttäjä voi hakea tietokannasta reseptejä hakusanalla. Yksi hakusana voi tuottaa monta tulosta.
	\item Reseptien listaus\(\colon\) käyttäjä voi listata reseptit ainesosan mukaan tai aakkos-- tai juomalajijärjestykseen.
	\item Ylläpito-oikeuden antaminen tavalliselle käyttäjälle\(\colon\) käyttäjä voi tehdä tavallisesta käyttäjästä ylläpitäjän. 
	\item Uuden reseptin ehdotuksen hyväksyminen\(\colon\) käyttäjä voi hyväksyä tavallisen käyttäjän reseptiehdotuksen, ja lisätä reseptin tietokantaan.
	\item Reseptin lisäys lomakkeella\(\colon\) käyttäjä voi lisätä reseptin käyttäen siihen tarkoitettua lomaketta.
	\item Reseptin lisäys tiedostosta\(\colon\) käyttäjä voi lisätä uuden reseptin lukemalla sen suoraan tiedostosta. 
	\item Muut käyttötapaukset\(\colon\) Käyttäjätietojen muutos, käyttäjätilin poisto, käyttäjätunnuksen luominen, reseptien selaaminen, kirjautuminen
\end{itemize}

\begin{flushleft}\textbf{Tavallinen käyttäjä\(\colon\)} \end{flushleft}

\begin{itemize}
	\item Reseptien haku \(\colon\) käyttäjä voi hakea tietokannasta reseptejä hakusanalla. Yksi hakusana voi tuottaa monta tulosta.
	\item Reseptien listaus\(\colon\) käyttäjä voi listata reseptit ainesosan mukaan tai aakkos-- tai juomalajijärjestykseen.
	\item Uuden reseptin ehdottaminen\(\colon\) käyttäjä voi ehdottaa uutta reseptiä ylläpitäjälle lisättäväksi tietokantaan.
	\item Muut käyttötapaukset\(\colon\) Käyttäjätietojen muutos, käyttäjätilin poisto, käyttäjätunnuksen luominen, reseptien selaaminen, kirjautuminen
\end{itemize}

\newpage
\section{Järjestelmän tietosisältö}
\begin{flushleft}\textbf{Käsitekaavio} \end{flushleft}

\includegraphics[scale=0.8]{kasitekaavio.pdf}

\begin{flushleft}\textbf{Juoma} \end{flushleft}
\begin{flushleft}
	\begin{tabular}{|l|l|l|}\hline
			Attribuutti      & Arvojoukko        & Kuvailu\\
			\hline
			nimi & merkkijono, maksimissaan 50 merkkiä & Juoman nimi.\\ 
			\hline		
			lisäyspäivämäärä & päivämäärä (date) & Päivämäärä, jolloin drinkkiohje on lisätty.\\ 
			\hline			
			juomalaji    & merkkijono,maksimissaan 50 merkkiä  & Juoman käyttötarkoitus. \\ 
			\hline
			kuvaus    & merkkijono, maksimissaan 400 merkkiä & Juoman kuvaus. \\ 
				\hline
	\end{tabular}
\end{flushleft}

\begin{flushleft}\textbf{Ainesosat} \end{flushleft}
\begin{flushleft}
	\begin{tabular}{|l|l|l|}
			\hline
			Attribuutti & Arvojoukko & Kuvailu \\ 
			\hline
			ainesosa & merkkijono, maksimissaan 50 merkkiä & Ainesosan nimi. \\ 
			\hline
	\end{tabular}
\end{flushleft}

\begin{flushleft}\textbf{Käyttäjä} \end{flushleft}
\begin{flushleft}
	\begin{tabular}{|l|l|l|}
			\hline
			Attribuutti & Arvojoukko & Kuvailu   \\ 
			\hline
			nimimerkki  & merkkijono, maksimissaan 50 merkkiä & Käyttäjän nimimerkki. \\ 
			\hline
			salasana    & merkkijono, maksimissaan 50 merkkiä & Käyttäjän salasana.   \\ 
			\hline
			ylläpitäjä    & boolean & Kertoo onko käyttäjä ylläpitäjä.   \\
			\hline
	\end{tabular}
\end{flushleft}

\begin{flushleft}\textbf{Ainesosayhteys} \end{flushleft}
\begin{flushleft}
	\begin{tabular}{|l|l|l|}
			\hline
			Attribuutti & Arvojoukko & Kuvailu   \\ 
			\hline
			juoma id  & lukujono & Yhteys Juoma-tauluun. \\ 
			\hline
			ainesosa id    & lukujono & Yhteys Ainesosa-tauluun.  \\ 
			\hline
	\end{tabular}
\end{flushleft}

\section{Relaatiokaavio}
\begin{flushleft}\textbf{Relaatiokaavio} \end{flushleft}

\includegraphics[scale=0.8]{relaatiokaavio.pdf}


\section{Järjestelmän yleisrakenne}

Kansiorakenne tulee melkein suoraan forkatusta reposta. ”App”-kansioon on sijoitettu alakansioita, 
joissa sijaitsevat samoilla nimillä kontrollerit, mallit ja näkymät. Näkymät on jaettu vielä alakansioihin 
sisällön mukaan (juoma, user ja aine). Malleista (models) löytyvät pääluokat juoma, user ja aine. Dokumentaatio 
sijaitsee kansiossa ”doc”. Sieltä löytyvät tähän sovellukseen liittyvät kaaviot ja ohjeet. Tietokantasovellusta
tehdessä on käytetty MVC-mallia. 

Sovellukseen kirjaudutaan, joka käynnistää session. Kirjautunut käyttäjä näkee listaukset ja pystyy muokkaamaan 
drinkkiohjeita. Kirjautunut käyttäjä pystyy myös muokkaamaan omia käyttäjätietojaan tai niin halutessaan poistamaan käyttäjätunnuksensa. Ylläpitäjä pystyy lisäämään kokonaisen uuden juomaohjeen sekä korottamaan tavallisen käyttäjän 
ylläpitäjäksi. Ylläpitäjä pystyy poistamaan muita käyttäjiä. Sovelluksesta pystyy kirjautumaan ulos, jolloin palaa takaisin etusivulle. 



\newpage
\section{Käyttöliittymä ja järjestelmän komponentit}
\begin{flushleft}\textbf{Käyttöliittymä ja järjestelmän komponentit} \end{flushleft}

\includegraphics[scale=0.8]{sivunakymat.pdf}

\section{Asennustiedot}

Sovelluksen tiedostot ovat tällä hetkellä users-palvelimella htdocs-hakemistossa, josta ne voi halutessaan kopioida.

Harjoitustyö löytyy osoitteesta \url{http://kaem.users.cs.helsinki.fi/Drinkkiarkisto/}


\section{Käynnistys- /käyttöohje}

Sovellukseen pitää kirjautua sisään. Kirjautumaton käyttäjä ei voi tehdä sivulla oikeastaan mitään. Kirjautunut käyttäjä voi olla joko tavallinen käyttäjä tai sitten ylläpitäjä. Ylläpitäjä näkee enemmän sisältöä sivuilla kuin tavallinen käyttäjä, muun muassa käyttäjäselailusivun.

Kirjautumissivulle pääsee joko etusivulta, tai sitten yläpalkin kautta. Kirjautumaton käyttäjä päätyy vain kirjautumissivulle, vaikka hän painaisi yläpalkissa mitä tahansa. Kirjautumisen jälkeen näkymät muuttuvat. Yläpalkissa on linkit ”Drinkkiarkisto”, joka johtaa etusivulle, ”Juomat”, joka johtaa kaikkien
juomareseptien listaussivulle, ja ”Aineet”, joka listaa juomien ainesosat omaksi listakseen. Ylläpitäjä näkee myös listan sovellukseen käyttäjistä. Kirjautuneen käyttäjän yläpalkissa on myös käyttäjätiedot, josta näkee omat käyttäjätietonsa, ja linkki uloskirjautumiseen.
Ylläpitäjän näkymää pääsee katsomaan käyttäjätunnuksella ”admin” ja sen salasanalla ”admin”. Tavallisen käyttäjän sivut aukeavat puolestaan tunnuksilla ”nimimerkki” ja sitä vastaavalla salasanalla ”salasana”.

\section{Testaus, tunnetut bugit ja puutteet ja jatkokehitysideat}
Olisin halunnut toteuttaa vielä ainakin juomareseptien haun joko reseptien nimen perusteella tai sitten ainesosan nimellä, mutta aika ei riittänyt. 

Juoman lisäyksessä on mahdollista tällä hetkellä lisätä sama juoma monta kertaa. Myöskin rekisteröityessä käyttäjäksi on mahdollista ottaa sama nimimerkki kuin jollain muulla, minkä korjaisin jos olisi enemmän aikaa. 

En tehnyt sovellukselle testausta, sillä sitä ei vaadittu eikä olisi oikein ollut aikaakaan.

\section{Omat kokemukset}
Harjoitustyön alussa olin kyllä aivan pihalla. Tuntuu, että näinä viikkoina vastaan on tullut sekalaisesti asiaa, joista osa on jäänyt hieman sumeaksi mielikuvaksi. Itselläni meni monta viikkoa, ennenkuin tajusin mallien, sivunäkymien, routesin ja kontrollereiden yhteyden. Kovasti tuntui, että kooditoteutukseni oli aikalailla samaa kuin materiaalissa ja jos materiaalissa ei jotain ollut painittu (kuten miten ylläpitäjän näkymät luodaan), niin ei sitä osannut itse oikein lähteä ajattelemaan. Tuntuu myös, että vieläkin koodissa on kohtia joita en ymmärrä. Mutta samaan aikaan tämän sovelluksen tekeminen on ollut kivaa, on hienoa nähdä miten saa asioita toimimaan ja pystyy lisäämään ja poistamaan tietokannsa asioita. Ehkäpä olisi tarvinnut enemmän aikaa, jotta olisi pystynyt kunnolla sisäisstämään mitä oikein on tekemässä ja tutkimaan erilailla toteutusvaihtoehtoja.

\section{Muu dokumentaatio}

SQL--luontitaulut löytyät repositiostani sql-kansiosta.

\end{document}
